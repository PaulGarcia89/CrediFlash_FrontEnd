{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/paulgarcia/Documents/ProyectosDesarrollo/ReactCrediFlash/ReactCrediFlash/material-dashboard-pro-react/crediflash-vuexy-next/src/api/http.js"],"sourcesContent":["import { clearSession } from '@/lib/auth/session'\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5001/api'\n\nconst TOKEN_KEYS = ['cf_token', 'accessToken', 'token', 'authToken']\n\nconst getToken = () => {\n  if (typeof window === 'undefined') return null\n\n  for (const key of TOKEN_KEYS) {\n    const value = window.localStorage.getItem(key)\n\n    if (value) return value\n  }\n\n  return null\n}\n\nconst buildUrl = (path, query) => {\n  const normalizedBase = API_BASE_URL.endsWith('/') ? API_BASE_URL.slice(0, -1) : API_BASE_URL\n  const normalizedPath = path.startsWith('/') ? path : `/${path}`\n  const url = new URL(`${normalizedBase}${normalizedPath}`)\n\n  if (query) {\n    Object.entries(query).forEach(([key, value]) => {\n      if (value !== undefined && value !== null && value !== '') {\n        url.searchParams.set(key, String(value))\n      }\n    })\n  }\n\n  return url.toString()\n}\n\nexport const apiRequest = async (path, { method = 'GET', query, body, auth = true } = {}) => {\n  const headers = {}\n  const isFormData = body instanceof FormData\n\n  if (!isFormData && body !== undefined) {\n    headers['Content-Type'] = 'application/json'\n  }\n\n  if (auth) {\n    const token = getToken()\n\n    if (token) {\n      headers.Authorization = `Bearer ${token}`\n    }\n  }\n\n  let response\n\n  try {\n    response = await fetch(buildUrl(path, query), {\n      method,\n      headers,\n      body: isFormData ? body : body !== undefined ? JSON.stringify(body) : undefined,\n      cache: 'no-store'\n    })\n  } catch {\n    throw new Error('No se pudo conectar con el backend en http://localhost:5001')\n  }\n\n  const payload = await response.json().catch(() => ({}))\n\n  if (!response.ok) {\n    if (response.status === 401 || response.status === 403) {\n      clearSession()\n    }\n\n    const message = payload?.message || payload?.error || `HTTP ${response.status}`\n    const error = new Error(message)\n\n    error.status = response.status\n    error.payload = payload\n\n    throw error\n  }\n\n  return payload\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,eAAe,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AAExD,MAAM,aAAa;IAAC;IAAY;IAAe;IAAS;CAAY;AAEpE,MAAM,WAAW;IACf,wCAAmC,OAAO;;;IAErC,MAAM;AAOb;AAEA,MAAM,WAAW,CAAC,MAAM;IACtB,MAAM,iBAAiB,aAAa,QAAQ,CAAC,OAAO,aAAa,KAAK,CAAC,GAAG,CAAC,KAAK;IAChF,MAAM,iBAAiB,KAAK,UAAU,CAAC,OAAO,OAAO,CAAC,CAAC,EAAE,MAAM;IAC/D,MAAM,MAAM,IAAI,IAAI,GAAG,iBAAiB,gBAAgB;IAExD,IAAI,OAAO;QACT,OAAO,OAAO,CAAC,OAAO,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;YACzC,IAAI,UAAU,aAAa,UAAU,QAAQ,UAAU,IAAI;gBACzD,IAAI,YAAY,CAAC,GAAG,CAAC,KAAK,OAAO;YACnC;QACF;IACF;IAEA,OAAO,IAAI,QAAQ;AACrB;AAEO,MAAM,aAAa,OAAO,MAAM,EAAE,SAAS,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,IAAI,EAAE,GAAG,CAAC,CAAC;IACtF,MAAM,UAAU,CAAC;IACjB,MAAM,aAAa,gBAAgB;IAEnC,IAAI,CAAC,cAAc,SAAS,WAAW;QACrC,OAAO,CAAC,eAAe,GAAG;IAC5B;IAEA,IAAI,MAAM;QACR,MAAM,QAAQ;QAEd,IAAI,OAAO;YACT,QAAQ,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;QAC3C;IACF;IAEA,IAAI;IAEJ,IAAI;QACF,WAAW,MAAM,MAAM,SAAS,MAAM,QAAQ;YAC5C;YACA;YACA,MAAM,aAAa,OAAO,SAAS,YAAY,KAAK,SAAS,CAAC,QAAQ;YACtE,OAAO;QACT;IACF,EAAE,OAAM;QACN,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,UAAU,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAErD,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,IAAI,SAAS,MAAM,KAAK,OAAO,SAAS,MAAM,KAAK,KAAK;YACtD,IAAA,4KAAY;QACd;QAEA,MAAM,UAAU,SAAS,WAAW,SAAS,SAAS,CAAC,KAAK,EAAE,SAAS,MAAM,EAAE;QAC/E,MAAM,QAAQ,IAAI,MAAM;QAExB,MAAM,MAAM,GAAG,SAAS,MAAM;QAC9B,MAAM,OAAO,GAAG;QAEhB,MAAM;IACR;IAEA,OAAO;AACT"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/paulgarcia/Documents/ProyectosDesarrollo/ReactCrediFlash/ReactCrediFlash/material-dashboard-pro-react/crediflash-vuexy-next/src/api/analytics.js"],"sourcesContent":["import { apiRequest } from './http'\n\nexport const obtenerAnalyticsDashboard = ({ fecha_desde = '', fecha_hasta = '' } = {}) =>\n  apiRequest('/analytics/dashboard', {\n    method: 'GET',\n    query: { fecha_desde, fecha_hasta }\n  })\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,4BAA4B,CAAC,EAAE,cAAc,EAAE,EAAE,cAAc,EAAE,EAAE,GAAG,CAAC,CAAC,GACnF,IAAA,+JAAU,EAAC,wBAAwB;QACjC,QAAQ;QACR,OAAO;YAAE;YAAa;QAAY;IACpC"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///Users/paulgarcia/Documents/ProyectosDesarrollo/ReactCrediFlash/ReactCrediFlash/material-dashboard-pro-react/crediflash-vuexy-next/src/views/modules/AnalyticsModule.jsx"],"sourcesContent":["'use client'\n\nimport { useCallback, useEffect, useState } from 'react'\n\nimport Alert from '@mui/material/Alert'\nimport Box from '@mui/material/Box'\nimport Button from '@mui/material/Button'\nimport Card from '@mui/material/Card'\nimport CardContent from '@mui/material/CardContent'\nimport Grid from '@mui/material/Grid'\nimport Stack from '@mui/material/Stack'\nimport Table from '@mui/material/Table'\nimport TableBody from '@mui/material/TableBody'\nimport TableCell from '@mui/material/TableCell'\nimport TableHead from '@mui/material/TableHead'\nimport TableRow from '@mui/material/TableRow'\nimport TextField from '@mui/material/TextField'\nimport Typography from '@mui/material/Typography'\n\nimport { obtenerAnalyticsDashboard } from '@/api/analytics'\n\nconst formatNumber = value => new Intl.NumberFormat('es-DO').format(Number(value || 0))\n\nconst formatMoney = value =>\n  new Intl.NumberFormat('es-DO', {\n    style: 'currency',\n    currency: 'DOP',\n    maximumFractionDigits: 2\n  }).format(Number(value || 0))\n\nconst KpiCard = ({ label, value }) => (\n  <Grid item xs={12} md={6} lg={3}>\n    <Card variant='outlined'>\n      <CardContent>\n        <Typography variant='caption' color='text.secondary'>\n          {label}\n        </Typography>\n        <Typography variant='h5'>{value}</Typography>\n      </CardContent>\n    </Card>\n  </Grid>\n)\n\nexport default function AnalyticsModule() {\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState('')\n  const [analytics, setAnalytics] = useState(null)\n  const [filtros, setFiltros] = useState({ fecha_desde: '', fecha_hasta: '' })\n\n  const fetchAnalytics = useCallback(\n    async customFiltros => {\n      setLoading(true)\n      setError('')\n\n      try {\n        const response = await obtenerAnalyticsDashboard(customFiltros || filtros)\n\n        setAnalytics(response)\n      } catch (err) {\n        setError(err.message || 'No se pudo cargar analytics.')\n      } finally {\n        setLoading(false)\n      }\n    },\n    [filtros]\n  )\n\n  useEffect(() => {\n    fetchAnalytics({})\n  }, [fetchAnalytics])\n\n  const kpis = analytics?.kpis || {}\n  const topClientes = analytics?.topClientes || []\n  const series = analytics?.series?.prestamosPorMes || []\n\n  const cuotasResumen = {\n    pagadas: kpis?.cuotas?.pagadas || 0,\n    pendientes: kpis?.cuotas?.pendientes || 0,\n    parciales: kpis?.cuotas?.parciales || 0\n  }\n\n  return (\n    <Stack spacing={2}>\n      <Box>\n        <Typography variant='h4'>Analytics</Typography>\n        <Typography color='text.secondary'>Resumen ejecutivo del negocio.</Typography>\n      </Box>\n\n      <Stack direction={{ xs: 'column', md: 'row' }} spacing={1.5} alignItems={{ md: 'end' }}>\n        <TextField\n          type='date'\n          label='Desde'\n          value={filtros.fecha_desde}\n          onChange={event => setFiltros(previous => ({ ...previous, fecha_desde: event.target.value }))}\n          size='small'\n          InputLabelProps={{ shrink: true }}\n        />\n        <TextField\n          type='date'\n          label='Hasta'\n          value={filtros.fecha_hasta}\n          onChange={event => setFiltros(previous => ({ ...previous, fecha_hasta: event.target.value }))}\n          size='small'\n          InputLabelProps={{ shrink: true }}\n        />\n        <Button variant='contained' onClick={() => fetchAnalytics()} disabled={loading}>\n          Filtrar\n        </Button>\n        <Button\n          variant='text'\n          onClick={() => {\n            const cleared = { fecha_desde: '', fecha_hasta: '' }\n\n            setFiltros(cleared)\n            fetchAnalytics(cleared)\n          }}\n          disabled={loading}\n        >\n          Limpiar\n        </Button>\n      </Stack>\n\n      {error ? <Alert severity='error'>{error}</Alert> : null}\n\n      <Grid container spacing={1.5}>\n        <KpiCard label='Total préstamos' value={formatNumber(kpis.totalPrestamos)} />\n        <KpiCard label='Monto total prestado' value={formatMoney(kpis.montoTotalPrestado)} />\n        <KpiCard label='Saldo pendiente' value={formatMoney(kpis.saldoPendienteTotal)} />\n        <KpiCard label='Ticket promedio' value={formatMoney(kpis.ticketPromedio)} />\n        <KpiCard label='Plazo promedio (semanas)' value={formatNumber(kpis.plazoPromedioSemanas)} />\n        <KpiCard label='Intereses' value={formatMoney(kpis.ingresosIntereses)} />\n        <KpiCard label='Tasa aprobación' value={`${formatNumber(kpis?.tasaAprobacion?.porcentaje)}%`} />\n        <KpiCard label='Morosidad vencida' value={formatNumber(kpis?.morosidad?.vencidas)} />\n      </Grid>\n\n      <Grid container spacing={1.5}>\n        <Grid item xs={12} lg={6}>\n          <Card>\n            <CardContent>\n              <Typography variant='h6'>Top clientes</Typography>\n              <Table size='small'>\n                <TableHead>\n                  <TableRow>\n                    <TableCell>Cliente</TableCell>\n                    <TableCell>Monto</TableCell>\n                  </TableRow>\n                </TableHead>\n                <TableBody>\n                  {topClientes.map(item => (\n                    <TableRow key={item.cliente_id}>\n                      <TableCell>{item.nombre_completo || item.cliente_id}</TableCell>\n                      <TableCell>{formatMoney(item.monto_total)}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </Grid>\n\n        <Grid item xs={12} lg={6}>\n          <Card>\n            <CardContent>\n              <Typography variant='h6'>Cuotas</Typography>\n              <Stack spacing={1} mt={1}>\n                <Typography>Pagadas: {formatNumber(cuotasResumen.pagadas)}</Typography>\n                <Typography>Pendientes: {formatNumber(cuotasResumen.pendientes)}</Typography>\n                <Typography>Parciales: {formatNumber(cuotasResumen.parciales)}</Typography>\n                <Typography>Monto vencido: {formatMoney(kpis?.morosidad?.monto_vencido)}</Typography>\n              </Stack>\n            </CardContent>\n          </Card>\n        </Grid>\n      </Grid>\n\n      <Card>\n        <CardContent>\n          <Typography variant='h6'>Préstamos por mes</Typography>\n          <Table size='small'>\n            <TableHead>\n              <TableRow>\n                <TableCell>Mes</TableCell>\n                <TableCell>Cantidad</TableCell>\n                <TableCell>Monto</TableCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {series.map(item => (\n                <TableRow key={item.mes}>\n                  <TableCell>{String(item.mes || '').slice(0, 10)}</TableCell>\n                  <TableCell>{formatNumber(item.total)}</TableCell>\n                  <TableCell>{formatMoney(item.monto)}</TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </Stack>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}